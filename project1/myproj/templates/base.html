<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shopping</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
  <style>

  </style>

</head>

<body>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>
  <div class="container">
    <header
      class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
      <a href="/" class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none">
        <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap">
          <use xlink:href="#bootstrap"></use>
        </svg>
      </a>

      <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
        <li><a href="/home" class="nav-link px-2 link-secondary">Home</a></li>
        <li><a href="/men" class="nav-link px-2 link-dark">Men</a></li>
        <li><a href="/women" class="nav-link px-2 link-dark">Women</a></li>
        <li><a href="/kids" class="nav-link px-2 link-dark">kids</a></li>
        <li><a href="/electronics" class="nav-link px-2 link-dark">Electronis</a></li>
      </ul>


      <div class="col-md-3 text-end">
        {% if user.is_authenticated %}
        you are loged in {{request.user}}
        {% else %}
        <button type="button" class="btn btn-primary mx-2" data-bs-toggle="modal" data-bs-target="#loginModal">
          Log in
        </button>
        <button type="button" class="btn btn-primary mx-2" data-bs-toggle="modal" data-bs-target="#signupModal">
          Signup
        </button>

        {% endif %}

      </div>

      <!-- <button type="button" class="btn btn-secondary" id="popcart" data-bs-container="body" data-bs-toggle="popover"
        data-bs-placement="bottom" data-bs-html="true" data-bs-content="popover">
        
      </button> -->
     <!-- Button trigger modal -->
<button type="button" class="btn btn-primary"  data-bs-toggle="modal" data-bs-target="#exampleModal">
  Cart(<span id="cart">0</span>)
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="popcart"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
    </header>
    
  </div>


  <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signuupModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="signupModal">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form class="row g-3" action="/signup" method='post'>
            {% csrf_token %}

            <div class="col-md-12">
              <label for="username" class="form-label">Username</label>
              <input type="text" class="form-control" id="username" name="username" required>
            </div><br>
            <div class="col-md-6">
              <label for="fname" class="form-label">fname</label>
              <input type="text" class="form-control" id="fname" name="fname" required>
            </div>
            <div class="col-md-6">
              <label for="lname" class="form-label">lname</label>
              <input type="text" class="form-control" id="lname" name="lname" required>
            </div>
            {% comment %} <div class="col-md-12">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email" required>
            </div> {% endcomment %}
            <div class="col-md-6">
              <label for="password" class="form-label">Password</label>
              <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <div class="col-md-6">
              <label for="Conformpassword" class="form-label">Conform password</label>
              <input type="password" class="form-control" id="Conformpassword" name="Conformpassword" required>
            </div>
            <div class="col-12">
              <label for="inputAddress" class="form-label">Address</label>
              <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St" required>
            </div>

            <div class="col-md-6">
              <label for="inputCity" class="form-label">City</label>
              <input type="text" class="form-control" id="inputCity" required>
            </div>
            <div class="col-md-4">
              <label for="inputState" class="form-label">State</label>
              <select id="inputState" class="form-select">
                <option selected>Choose...</option>
                <option>...</option>
              </select>
            </div>
            <div class="col-md-2">
              <label for="inputZip" class="form-label">Zip</label>
              <input type="text" class="form-control" id="inputZip" required>
            </div>
            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="gridCheck">
                <label class="form-check-label" for="gridCheck">
                  Check me out
                </label>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="Sign in" class="btn btn-primary">Sign in</button>
            </div>
            {% comment %} <div class="col-12">
              <button type="submit" class="btn btn-primary">Sign in</button>
            </div> {% endcomment %}

          </form>
        </div>
        {% comment %} <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Sign in</button>
        </div> {% endcomment %}
      </div>
    </div>
  </div>



  {% comment %} login------- {% endcomment %}

  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loginModal">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form class="row g-3" method='post' action="/login">
            {% csrf_token %}
            <div class="col-md-12">
              <label for="loginusername" class="form-label">Username</label>
              <input type="text" class="form-control" id="loginusername" name="loginusername" required>
            </div><br>

            <div class="col-md-12">
              <label for="pass" class="form-label">Password</label>
              <input type="password" class="form-control" id="pass" name="pass" required>
            </div>
            <div class="modal-footer">
              <div class="col-12">
                <button type="sign in" class="btn btn-primary">Sign in</button>
              </div>

            </div>

          </form>
        </div>

      </div>
    </div>
  </div>
  </div>



  {% block body %}{% endblock body %}
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  {% block js %}

  <script>


    console.log("Hello World")
    if (localStorage.getItem('cart') == null) {
      var cart = {};
    }
    else {
      cart = JSON.parse(localStorage.getItem('cart'));
      document.getElementById('cart').innerHTML = Object.keys(cart).length;
      // updatecart(cart);

    }
    $(".cart").click(function () {
      console.log('click')
      var idstr = this.id.toString();
      // console.log(idstr);
      if (cart[idstr] != undefined) {
        qty=cart[idstr][0] + 1;
   
      }
      else {
        qty= 1;
        name="My name";
        cart[idstr] = [qty,name];
      }
      // updatecart(cart);
    });



    function updatePopover(cart) {

      var popStr = "";
      popStr = popStr + "<h5> Cart for your items in my shopping cart </h5><div class='mx-2 my-2'>";
      var i = 1;
      for (var item in cart) {
        popStr = popStr + "<b>" + i + "</b>. ";
        popStr = popStr + document.getElementById('name' + item).innerHTML.slice(0, 19) + "... Qty: " + cart[item][0] + '<br>';
        i = i + 1;
      }
      popStr = popStr + "</div>"
      document.getElementById('popcart').innerHTML=popStr;


    }

    function updatecart(cart) {
      for (var item in cart) {
        // sum=sum+cart[item][0];
        document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      document.getElementById('cart').innerHTML = Object.keys(cart).length;
      //  console.log(cart) 


    }

    $('.divpr').on("click", "button.minus", function () {
      console.log("minus clicked");
      a = this.id.slice(7,);
      cart['pr' + a][0] = cart['pr' + a][0] - 1;
      cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
      document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
      updateCart(cart);



    });

    $('.divpr').on("click", "button.plus", function () {
      console.log("plus clicked");
      a = this.id.slice(6,);
      cart['pr' + a][0] = cart['pr' + a][0] + 1;
      cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
      document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
      updateCart(cart);
    });
   


  </script>
  {% endblock js %}


</body>

</html>